<div class="feedings-container">
  <div class="header-section">
    <app-back-button></app-back-button>
    <h1 class="page-title">Feeding</h1>
    <button class="add-feeding-button" (click)="openModal()">+</button>
  </div>

  <div class="pet-filter" *ngIf="pets.length > 0">
    <select id="pet-filter" [(ngModel)]="selectedPetId" (change)="onPetFilterChange()">
      <option *ngFor="let pet of pets" [value]="pet.id">{{ pet.name }}</option>
    </select>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="isLoading" class="loading">Loading...</div>

  <div *ngIf="!isLoading && feedingsByDate.length === 0" class="no-data">
    <p>No feeding records yet. Click "Add Feeding" to get started!</p>
  </div>

  <div class="feeding-groups">
    <div *ngFor="let group of feedingsByDate" class="date-group">
      <div class="date-header">
        <h2>{{ group.date }}</h2>
        <span class="total-sum">{{ group.feedings | feedingsSum }}g</span>
      </div>
      <div class="feeding-table-container">
        <table class="feeding-table">
          <tbody>
            <tr class="feeding-row">
              <td *ngFor="let feeding of group.feedings" class="grams-cell" (click)="editFeeding(feeding)">
                <div class="grams">{{ feeding.grams }}g</div>
                <div class="feeding-time">{{ formatTime(feeding.fedAt) }}</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <app-add-feeding-modal
    [isOpen]="showModal"
    [selectedPetId]="selectedPetId"
    [existingFeeding]="editingFeeding"
    [pets]="pets"
    (close)="closeModal()"
    (feedingAdded)="onFeedingAdded($event)"
    (feedingUpdated)="onFeedingUpdated($event)"
    (feedingDeleted)="onFeedingDeleted($event)"
  ></app-add-feeding-modal>
</div>
