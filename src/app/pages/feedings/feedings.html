<div class="feedings-container">
  <div class="header-section">
    <app-back-button></app-back-button>
    <h1 class="page-title">Feeding</h1>
    <button class="add-feeding-button" (click)="openModal()">+</button>
  </div>

  <div class="pet-filter" *ngIf="pets.length > 0">
    <select id="pet-filter" [(ngModel)]="selectedPetId" (change)="onPetFilterChange()">
      <option *ngFor="let pet of pets" [value]="pet.id">{{ pet.name }}</option>
    </select>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="isLoading" class="loading">Loading...</div>

  <div *ngIf="!isLoading && feedingsByDate.length === 0" class="no-data">
    <p>No feeding records yet. Click "Add Feeding" to get started!</p>
  </div>

  <div class="feeding-groups">
    <div *ngFor="let group of feedingsByDate" class="date-group">
      <div class="date-header">
        <h2>{{ group.date }}</h2>
        <span class="total-sum">{{ group.feedings | feedingsSum }}g</span>
      </div>
      <div class="feeding-table-container">
        <table class="feeding-table">
          <tbody>
            <tr class="feeding-row">
              <td *ngFor="let feeding of group.feedings" class="grams-cell">
                <div class="grams">{{ feeding.grams }}g</div>
                <div class="feeding-time">{{ formatTime(feeding.fedAt) }}</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <app-modal [isOpen]="showModal" [title]="'Add Feeding'" (close)="closeModal()">
    <form (ngSubmit)="submitFeeding()">
      <div class="form-group">
        <label for="pet">Pet *</label>
        <select id="pet" [(ngModel)]="newFeeding.petId" name="pet" required>
          <option *ngFor="let pet of pets" [value]="pet.id">{{ pet.name }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="fedAt">Date & Time *</label>
        <input
          type="datetime-local"
          id="fedAt"
          [(ngModel)]="newFeeding.fedAt"
          name="fedAt"
          required
        />
      </div>

      <div class="form-group">
        <label for="grams">Grams *</label>
        <input
          #gramsInput
          type="number"
          id="grams"
          [(ngModel)]="newFeeding.grams"
          name="grams"
          placeholder="e.g., 200"
          min="1"
          required
        />
      </div>

      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea
          id="notes"
          [(ngModel)]="newFeeding.notes"
          name="notes"
          rows="3"
          placeholder="Any additional notes..."
        ></textarea>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading || !gramsInput.value">
          {{ isLoading ? 'Adding...' : 'Add Feeding' }}
        </button>
      </div>
    </form>
  </app-modal>
</div>
