<div class="user-profile-container">
  <div class="header-section">
    <app-back-button></app-back-button>
    <h1 class="page-title">Profile</h1>
    <div class="placeholder"></div>
  </div>

  <!-- Update Profile Section -->
  <section class="profile-section">
    <h2>Personal Information</h2>
    
    @if (profileMessage) {
      <div class="success-message">{{ profileMessage }}</div>
    }
    @if (profileError) {
      <div class="error-message">{{ profileError }}</div>
    }

    <form [formGroup]="profileForm" (ngSubmit)="updateUser(profileForm)">
      <div class="form-group">
        <label for="firstName">First Name *</label>
        <input
          type="text"
          id="firstName"
          formControlName="firstName"
        />
        @if (profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched) {
          <div class="field-error">First name is required</div>
        }
      </div>

      <div class="form-group">
        <label for="lastName">Last Name *</label>
        <input
          type="text"
          id="lastName"
          formControlName="lastName"
        />
        @if (profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched) {
          <div class="field-error">Last name is required</div>
        }
      </div>

      <div class="form-group">
        <label for="email">Email *</label>
        <input
          type="email"
          id="email"
          formControlName="email"
        />
        @if (profileForm.get('email')?.invalid && profileForm.get('email')?.touched) {
          <div class="field-error">
            @if (profileForm.get('email')?.hasError('required')) {
              Email is required
            } @else if (profileForm.get('email')?.hasError('email')) {
              Invalid email format
            }
          </div>
        }
      </div>

      <div class="button-wrapper">
        <button type="submit" class="btn btn-primary" [disabled]="isLoadingProfile">
          {{ isLoadingProfile ? 'Updating...' : 'Update Profile' }}
        </button>
      </div>
    </form>
  </section>

  <!-- Update Password Section -->
  <section class="profile-section">
    <h2>Change Password</h2>
    
    @if (passwordMessage) {
      <div class="success-message">{{ passwordMessage }}</div>
    }
    @if (passwordError) {
      <div class="error-message">{{ passwordError }}</div>
    }

    <form [formGroup]="passwordForm" (ngSubmit)="updateUser(passwordForm, true)">
      <div class="form-group">
        <label for="currentPassword">Current Password *</label>
        <input
          type="password"
          id="currentPassword"
          formControlName="currentPassword"
        />
        @if (passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched) {
          <div class="field-error">Current password is required</div>
        }
      </div>

      <div class="form-group">
        <label for="newPassword">New Password *</label>
        <input
          type="password"
          id="newPassword"
          formControlName="newPassword"
        />
        @if (passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched) {
          <div class="field-error">
            @if (passwordForm.get('newPassword')?.hasError('required')) {
              Password is required
            } @else if (passwordForm.get('newPassword')?.hasError('minlength')) {
              Password must be at least 8 characters
            } @else if (passwordForm.get('newPassword')?.hasError('pattern')) {
              Password must contain letters and digits
            }
          </div>
        }
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirm New Password *</label>
        <input
          type="password"
          id="confirmPassword"
          formControlName="confirmPassword"
        />
        @if (passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched) {
          <div class="field-error">Please confirm your password</div>
        }
      </div>

      <div class="button-wrapper">
        <button type="submit" class="btn btn-primary" [disabled]="isLoadingPassword">
          {{ isLoadingPassword ? 'Updating...' : 'Update Password' }}
        </button>
      </div>
    </form>
  </section>
</div>
